# Настройка внеполосного управления

### Включаем службу в firewall на ESXi

1. Пеходим в раздел `Manage`
2. Переходим во вкладку `Services`
3. Выбираем сервис `TSM-SSH`
4. Запускаме службу нажав на кнопку `Start`

<img src="05.png" width='600'>

5. Откурываем `PUTTY`, вводим `IP адрес` стенда
6. Выбираем протокол `SSH`
7. Нажимаем кнопку `OPEN`

<img src="06.png" width='600'>

8. Вводим имя пользователя `root`
9. Вводим пароль от пользователя `root`. Такой же как вы вводите при подключение через web-браузер

<img src="07.png" width='600'>

10. Включаем правило `remoteSerialPort` в фаерволе

``` 
esxcli network firewall ruleset set --enabled=True --ruleset-id=remoteSerialPort
```
11. Введите комманду для вывода списка правил.
12. Убедитесь, что правило `remoteSerialPort` имеет значение `True`

<img src="08.png" width='600'>

### Настраиваем виртуальные машины

1. Выключаем виртуальную машину нажав кнопку `Power off`
2. Переходим в редактирование виртуальноый машины нажав кнопку `Edit`

<img src="01.png" width='600'>

3. Добавляем новое устройство нажав на `Add other device`
4. Выбираем пункт `Serial port`

<img src="02.png" width='600'>

5. Изменяем тип порта на `Use network`
6. В строку `Port URL` добавляем значение в формате `telnet://0.0.0.0:<port>`. Номер порта для каждой виртуальной машины должен быть уникальным
7. Сохраняем изменения нажав кнопку `SAVE`
8. Включаем виртуальную машину.

<img src="03.png" width='600'>

Проделываем эту процедуру для всех виртуальных машин.

В виртуальных машинах с `Linux` нужно включить службу, добавить ее в автозагрузку и проверить статус:

```
systemctl start serial-getty@ttyS0.service
systemctl enable serial-getty@ttyS0.service
systemctl status serial-getty@ttyS0.service
```

Открывам любую консольку и подключаемся к `ESXi` с ее помощью по протоколу `telnet`

В этом примере используется `PUTTY`

1. Вписываем ip адрес вашего стенда.
2. Указываем порт, который указывали в настройуках виртуальной машины.

<img src="04.png" width='600'>